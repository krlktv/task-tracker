"use strict";const addTaskForm=document.querySelector("#addTaskForm"),currentTasks=document.querySelector("#currentTasks"),completedTasks=document.querySelector("#completedTasks"),ascBtn=document.querySelector("#incr"),descBtn=document.querySelector("#decr"),toDoHeading=document.querySelector("#toDoHeading"),completedHeading=document.querySelector("#completedHeading"),tasksContainer=document.querySelector("#tasksContainer"),clearAllBtn=document.querySelector("#clearAll"),editTaskForm=document.querySelector("#editTaskForm");let currentEditId="";const SORTING={asc:"incr",desc:"decr"},PRIORITY={low:"Low",medium:"Medium",high:"High"},themeToggleBtn=document.querySelector(".custom-control-input");render(),localStorage.setItem(0,SORTING.asc),themeToggleBtn.addEventListener("change",toggleTheme),ascBtn.addEventListener("click",()=>{setSorting(SORTING.asc),render()}),descBtn.addEventListener("click",()=>{setSorting(SORTING.desc),render()}),clearAllBtn.addEventListener("click",()=>{const t=localStorage.getItem(0);localStorage.clear(),localStorage.setItem(0,t),render()}),addTaskForm.addEventListener("submit",t=>{t.preventDefault(),addTaskToLocalStorage(getNewTaskData()),render(),addTaskForm.reset(),addTaskForm.querySelector('[data-dismiss="modal"]').click()}),tasksContainer.addEventListener("click",t=>{if(t.target.classList.contains("btn-danger")){deleteTask(getTaskId(t)),render()}if(t.target.classList.contains("btn-success")){toggleCompleteness(getTaskId(t)),render()}if(t.target.classList.contains("btn-info")){const e=getTaskId(t);fillTaskData(e),currentEditId=e}}),editTaskForm.addEventListener("submit",t=>{t.preventDefault(),addTaskToLocalStorage(getEditTaskData()),render(),editTaskForm.reset(),editTaskForm.querySelector('[data-dismiss="modal"]').click()});class Task{constructor(t,e,r,o){this.id=t,this.title=e,this.text=r,this.priority=o,this.date=Date.now(),this.isCompleted=!1}}function getNewTaskData(){const t=localStorage.length,e=document.querySelector("#inputTitle").value,r=document.querySelector("#inputText").value,o=document.querySelector("#Medium").checked,a=document.querySelector("#High").checked;let n="";return n=o?PRIORITY.medium:a?PRIORITY.high:PRIORITY.low,new Task(t,e,r,n)}function addTaskToLocalStorage(t){localStorage.setItem(t.id,JSON.stringify(t))}function clearForRender(){for(;currentTasks.firstChild;)currentTasks.removeChild(currentTasks.firstChild);for(;completedTasks.firstChild;)completedTasks.removeChild(completedTasks.firstChild)}function toTaskDate(t){const e=new Date(t);let r=e.getHours(),o=e.getMinutes(),a=e.getDate(),n=e.getMonth()+1;return r<10&&(r=`0${r}`),o<10&&(o=`0${o}`),a<10&&(a=`0${a}`),n<10&&(n=`0${n}`),`${r}:${o} ${a}.${n}.${e.getFullYear()}`}function renderTasks(){let t=0,e=0;const r=sortBy(localStorage.getItem(0));for(let o=0;o<r.length;o++){const a=r[o];if(a){let r="bg-warning";a.priority===PRIORITY.low?r="bg-info":a.priority===PRIORITY.high&&(r="bg-danger");const o='<button type="button" class="btn btn-info w-100" data-toggle="modal" data-target="#editModal">Edit</button>',n=a.isCompleted?"":o,s=document.createElement("li");s.className=createTaskClassName(r),s.dataset.id=a.id,s.innerHTML=createTaskTemplate(a.title,a.priority,a.date,a.text,n),a.isCompleted?(completedTasks.appendChild(s),e++):(currentTasks.appendChild(s),t++)}}toDoHeading.textContent=`ToDo (${t})`,completedHeading.textContent=`Completed (${e})`}function deleteTask(t){localStorage.setItem(t,null)}function toggleCompleteness(t){const e=JSON.parse(localStorage.getItem(t));e.isCompleted=!e.isCompleted,localStorage.setItem(t,JSON.stringify(e))}function fillTaskData(t){const e=JSON.parse(localStorage.getItem(t)),r=document.querySelector("#editModal");r.querySelector("#editInputTitle").value=e.title,r.querySelector("#editInputText").value=e.text,e.priority===PRIORITY.low?r.querySelector("#editLow").checked=!0:e.priority===PRIORITY.medium?r.querySelector("#editMedium").checked=!0:r.querySelector("#editHigh").checked=!0}function getEditTaskData(){const t=JSON.parse(localStorage.getItem(currentEditId));return t.title=editTaskForm.querySelector("#editInputTitle").value,t.text=editTaskForm.querySelector("#editInputText").value,editTaskForm.querySelector("#editMedium").checked?t.priority=PRIORITY.medium:editTaskForm.querySelector("#editHigh").checked?t.priority=PRIORITY.high:t.priority=PRIORITY.low,t}function render(){clearForRender(),renderTasks()}function getTaskId(t){return t.target.closest(".list-group-item").dataset.id}function createTaskClassName(t){return`list-group-item d-flex w-100 mb-2 ${t}`}function createTaskTemplate(t,e,r,o,a){return`\n\t\t<div class="w-100 mr-2">\n\t\t\t<div class="d-flex w-100 justify-content-between">\n\t\t\t\t<h5 class="mb-1">${t}</h5>\n\t\t\t\t<div>\n\t\t\t\t\t<small class="mr-2">${e} priority</small>\n\t\t\t\t\t<small>${toTaskDate(new Date(r))}</small>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<p class="mb-1 w-100">${o}</p>\n\t\t</div>\n\t\t<div class="dropdown m-2 dropleft">\n\t\t\t<button class="btn btn-secondary h-100" type="button" id="dropdownMenuItem1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t<i class="fas fa-ellipsis-v" aria-hidden="true"></i>\n\t\t\t</button>\n\t\t\t<div class="dropdown-menu p-2 flex-column" aria-labelledby="dropdownMenuItem1">\n\t\t\t\t<button type="button" class="btn btn-success w-100 mb-2">Toggle completeness</button>\n\t\t\t\t${a}\n\t\t\t\t<button type="button" class="btn btn-danger w-100 mt-2">Delete</button>\n\t\t\t</div>\n\t\t</div>\n\t`}function setSorting(t){localStorage.setItem(0,t)}function addToTasksArray(t,e){t.push(JSON.parse(localStorage.getItem(e)))}function toggleTheme(){document.querySelector("body").classList.toggle("dark")}function sortBy(t){const e=[];for(let t=1;t<localStorage.length;t++)addToTasksArray(e,t);return t===SORTING.desc&&e.reverse(),e}